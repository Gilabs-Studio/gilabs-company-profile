---
import "../styles/globals.css";
import LightRays from "../components/ui/LightRays";

const { 
	lang = Astro.currentLocale || 'en', 
	title = 'Gilabs.id',
	description = 'Premium Software Agency specializing in web development, mobile apps, and digital solutions. Transform your business with cutting-edge technology.',
	canonical = Astro.url.href,
	robots = 'index, follow',
	noindex = false,
	keywords = 'web development, mobile app development, software agency, digital solutions, UI/UX design, custom software, web design, app development Indonesia, ERP system, CRM system, software development company, web application development, mobile application development, e-commerce development, enterprise software, digital transformation, software consulting, Indonesia software company'
} = Astro.props;

const siteUrl = 'https://gilabs.id';
const fullCanonical = canonical.startsWith('http') ? canonical : `${siteUrl}${canonical}`;
const robotsContent = noindex ? 'noindex, nofollow' : robots;
---
<!doctype html>
<html lang={lang} class="scroll-smooth">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />
		
		<!-- Primary Meta Tags -->
		<title>{title}</title>
		<meta name="title" content={title} />
		<meta name="description" content={description} />
		<meta name="keywords" content={keywords} />
		<meta name="robots" content={robotsContent} />
		<meta name="author" content="Gilabs.id" />
		<meta name="publisher" content="Gilabs.id" />
		
		<!-- Canonical URL -->
		<link rel="canonical" href={fullCanonical} />
		
		<!-- Open Graph / Facebook -->
		<meta property="og:type" content="website" />
		<meta property="og:url" content={fullCanonical} />
		<meta property="og:title" content={title} />
		<meta property="og:description" content={description} />
		<meta property="og:site_name" content="Gilabs.id" />
		<meta property="og:locale" content={lang === 'id' ? 'id_ID' : 'en_US'} />
		
		<!-- Twitter -->
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:title" content={title} />
		<meta name="twitter:description" content={description} />
		
		<!-- Additional SEO -->
		<meta name="language" content={lang === 'id' ? 'Indonesian' : 'English'} />
		<meta name="geo.region" content={lang === 'id' ? 'ID' : 'US'} />
		
		<!-- Structured Data (Schema.org) -->
		<script type="application/ld+json" set:html={JSON.stringify({
			"@context": "https://schema.org",
			"@type": "Organization",
			"name": "Gilabs.id",
			"alternateName": "Gilabs Software Agency",
			"url": "https://gilabs.id",
			"logo": "https://gilabs.id/favicon.svg",
			"description": description,
			"address": {
				"@type": "PostalAddress",
				"addressCountry": "ID"
			},
			"contactPoint": {
				"@type": "ContactPoint",
				"contactType": "Customer Service",
				"availableLanguage": lang === 'id' ? "Indonesian" : "English"
			},
			"sameAs": [
				"https://gilabs.id"
			],
			"areaServed": {
				"@type": "Country",
				"name": "Indonesia"
			},
			"knowsAbout": [
				"Web Development",
				"Mobile App Development",
				"Software Development",
				"Software House",
				"UI/UX Design",
				"Digital Solutions",
				"ERP Systems",
				"CRM Systems"
			]
		})} />
		
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400;500;600;700;800&display=swap" rel="stylesheet">
	</head>
	<body class="bg-background text-foreground font-sans antialiased relative selection:bg-brand selection:text-white">
    <div class="fixed inset-0 z-[-1] pointer-events-none">
      <LightRays 
        client:only="react"
        raysColor="#FBFBFB" 
        raysSpeed={0.5} 
        lightSpread={0.5}
        rayLength={1.5}
        raysOrigin="top-center"
      />
    </div>
		<slot />
	</body>

<script>
  // Safety check to prevent scroll from getting stuck
  // This ensures body overflow is always reset properly
  (function() {
    let lastScrollTop = window.pageYOffset || document.documentElement.scrollTop;
    let scrollStuckCount = 0;
    const MAX_STUCK_COUNT = 3;

    function checkScrollHealth() {
      const currentScrollTop = window.pageYOffset || document.documentElement.scrollTop;
      
      // If scroll position hasn't changed but user is trying to scroll, reset overflow
      if (currentScrollTop === lastScrollTop && document.body.style.overflow === 'hidden') {
        scrollStuckCount++;
        
        if (scrollStuckCount >= MAX_STUCK_COUNT) {
          // Force reset body styles if scroll appears stuck
          document.body.style.overflow = '';
          document.body.style.position = '';
          document.body.style.width = '';
          scrollStuckCount = 0;
        }
      } else {
        scrollStuckCount = 0;
      }
      
      lastScrollTop = currentScrollTop;
    }

    // Check scroll health periodically
    setInterval(checkScrollHealth, 100);

    // Also check on visibility change (when console is opened/closed)
    document.addEventListener('visibilitychange', () => {
      // Reset any stuck overflow states when page becomes visible
      if (!document.hidden) {
        const hasOverflowHidden = document.body.style.overflow === 'hidden';
        const hasPositionFixed = document.body.style.position === 'fixed';
        
        // Only reset if no modal/drawer is actually open
        // Check if mobile menu is closed
        const mobileMenu = document.getElementById('mobile-menu');
        const isMobileMenuOpen = mobileMenu && !mobileMenu.classList.contains('opacity-0');
        
        // Check if project drawer is open (check for backdrop)
        const hasBackdrop = document.querySelector('.fixed.inset-0.bg-black\\/60');
        
        if (!isMobileMenuOpen && !hasBackdrop && (hasOverflowHidden || hasPositionFixed)) {
          document.body.style.overflow = '';
          document.body.style.position = '';
          document.body.style.width = '';
        }
      }
    });

    // Ensure scroll is enabled on page load
    window.addEventListener('load', () => {
      document.body.style.overflow = '';
      document.body.style.position = '';
      document.body.style.width = '';
    });
  })();
</script>
</html>

<style>
	html,
	body {
		margin: 0;
		width: 100%;
		height: 100%;
	}
</style>
